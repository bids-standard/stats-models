
<!DOCTYPE html>


<html lang="en" data-content_root="./" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Legacy specification &#8212; BIDS Stats Models Specification</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=b90f6cf3" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="_static/documentation_options.js?v=ad5861b1"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'legacy';</script>
    <script src="_static/documentation_options.js?v=ad5861b1"></script>
    <script src="_static/js/jsoneditor.js?v=b2913772"></script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="JSON 101" href="json_101.html" />
    <link rel="prev" title="Integration with other standards" href="integration.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
    
    <img src="_static/bids_black.png" class="logo__image only-light" alt="BIDS Stats Models Specification - Home"/>
    <script>document.write(`<img src="_static/bids_black.png" class="logo__image only-dark" alt="BIDS Stats Models Specification - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="motivation.html">Motivation</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="walkthrough-intro.html">Walkthrough</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="walkthrough-1.html">Representing multi-stage neuroimaging models</a></li>
<li class="toctree-l2"><a class="reference internal" href="walkthrough-2.html">Advanced usage</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="integration.html">Integration with other standards</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Legacy specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="json_101.html">JSON 101</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Specification</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="spec.html">BIDS Stats Models Specification</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="reference.html">BIDS Stats Models Object Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/bsmschema.models.BIDSStatsModel.html">bsmschema.models.BIDSStatsModel</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/bsmschema.models.Node.html">bsmschema.models.Node</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/bsmschema.models.Transformations.html">bsmschema.models.Transformations</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/bsmschema.models.Model.html">bsmschema.models.Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/bsmschema.models.HRF.html">bsmschema.models.HRF</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/bsmschema.models.Options.html">bsmschema.models.Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/bsmschema.models.Contrast.html">bsmschema.models.Contrast</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/bsmschema.models.DummyContrasts.html">bsmschema.models.DummyContrasts</a></li>
<li class="toctree-l2"><a class="reference internal" href="_autosummary/bsmschema.models.Edge.html">bsmschema.models.Edge</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="validator.html">BIDS Stats Model Validator</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples and resources</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="model-zoo.html">Model Zoo</a></li>
<li class="toctree-l1"><a class="reference internal" href="default_model.html">Creating a default model</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/bids-standard/stats-models" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/bids-standard/stats-models/issues/new?title=Issue%20on%20page%20%2Flegacy.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/legacy.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Legacy specification</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-nodes">Analysis nodes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-node-sequences">Specifying node sequences</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#node-structure">Node structure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enumerating-sequences-of-nodes">Enumerating sequences of Nodes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs">Inputs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-image-inputs">Specifying image inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-input-output-chaining-between-levels">Automatic input/output chaining between levels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-ingestion-of-design-level-and-scan-level-variables"><strong>Automatic ingestion of design-level and scan-level variables</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-intercept-variable">The intercept variable</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transformations">Transformations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-the-model">Specifying the model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contrasts">Contrasts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contrast-specification">Contrast specification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dummy-contrasts">Dummy contrasts</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="legacy-specification">
<h1>Legacy specification<a class="headerlink" href="#legacy-specification" title="Link to this heading">#</a></h1>
<p>This document exists to preserve components in the <a class="reference external" href="https://docs.google.com/document/d/1bq5eNDHTb6Nkx3WUiOBgKvLNnaa5OMcGtD0AZ9yms2M/edit">Google Doc</a> until they are fully
incorporated into another part of this website.</p>
<section id="analysis-nodes">
<h2>Analysis nodes<a class="headerlink" href="#analysis-nodes" title="Link to this heading">#</a></h2>
<section id="specifying-node-sequences">
<h3>Specifying node sequences<a class="headerlink" href="#specifying-node-sequences" title="Link to this heading">#</a></h3>
<p>Each analysis specification is composed of a collection of Nodes,
each describing a level of modeling (for example, run or subject),
and one or more sequences of these Nodes.
In traditional fMRI analysis packages such as SPM, FSL and AFNI,
which use the “summary statistics” approach,
the meaning of the levels of analysis is usually highly constrained,
and reflects a fixed hierarchy of entities that one ascends sequentially.
Most commonly, the 1st level analysis is understood to refer to
the statistical analysis of each individual BOLD run,
and the 2nd level analysis refers to the analysis of either a single subject
(which typically involves aggregating over 2 or more sets of 1st level results)
or an entire group of subjects (in the case where there’s only one run per subject).
Alternatively, in some packages (like SPM), runs are first concatenated within-subject,
producing only 2-level structures (subject and group).
This hierarchy is not entirely rigid,
as it is sometimes necessary to inject another level into the mix – for example,
when each subject is scanned in multiple sessions, one may have a 4-level structure,
where the levels reflect the modeling of runs, sessions, subjects, and groups, respectively.</p>
<p>At present, the BIDS Stats Model spec assumes the same sequential hierarchy.
Thus, the following node sequences are all valid:</p>
<ul class="simple">
<li><p>run → subject → dataset</p></li>
<li><p>run → session → subject → dataset</p></li>
<li><p>run → subject</p></li>
<li><p>subject → dataset</p></li>
</ul>
<p>A key point to appreciate here is that the keyword associated with each level of analysis
(meaning “run”, “session”, “subject”, or “dataset”)
describes the grouping structure of the analysis,
rather than specifying the precise nature of the inputs and outputs.
The grouping structure must be made explicit in the <a class="reference internal" href="_autosummary/bsmschema.models.Node.html#bsmschema.models.Node.GroupBy" title="bsmschema.models.Node.GroupBy"><code class="xref py py-attr docutils literal notranslate"><span class="pre">GroupBy</span></code></a> list
(see <a class="reference internal" href="_autosummary/bsmschema.models.Node.html#bsmschema.models.Node" title="bsmschema.models.Node"><code class="xref py py-class docutils literal notranslate"><span class="pre">Node</span></code></a>).
The Level does determine what variables will be available to the model (see §3.3 below).</p>
</section>
<section id="node-structure">
<h3>Node structure<a class="headerlink" href="#node-structure" title="Link to this heading">#</a></h3>
<p>Each analysis node has fields defined in <a class="reference internal" href="_autosummary/bsmschema.models.Node.html#bsmschema.models.Node" title="bsmschema.models.Node"><code class="xref py py-class docutils literal notranslate"><span class="pre">Node</span></code></a>.</p>
<p>The <a class="reference internal" href="_autosummary/bsmschema.models.Node.html#bsmschema.models.Node.Model" title="bsmschema.models.Node.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> specification MUST be invoked prior to
<a class="reference internal" href="_autosummary/bsmschema.models.Node.html#bsmschema.models.Node.Contrasts" title="bsmschema.models.Node.Contrasts"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contrasts</span></code></a> and
<a class="reference internal" href="_autosummary/bsmschema.models.Node.html#bsmschema.models.Node.DummyContrasts" title="bsmschema.models.Node.DummyContrasts"><code class="xref py py-class docutils literal notranslate"><span class="pre">DummyContrasts</span></code></a>.
That is, first, the <code class="docutils literal notranslate"><span class="pre">Model</span></code> specification is processed,
typically resulting in the estimation of some model.
Then, the <code class="docutils literal notranslate"><span class="pre">Contrasts</span></code> are generated from the parameter estimates obtained from
the model estimation step and/or propagated from previous levels (see section 3.2).
Note that all applicable variables may be used for grouping.
For example, if a task has multiple runs and multiple subjects,
to separately fit a run-level model for each run from each subject,
one should specify <code class="docutils literal notranslate"><span class="pre">&quot;GroupBy&quot;:</span> <span class="pre">[&quot;run&quot;,</span> <span class="pre">&quot;subject&quot;]</span></code>.
If <code class="docutils literal notranslate"><span class="pre">&quot;run&quot;</span></code> is omitted, then all runs for each subject will be fit with a single model;
likewise, if <code class="docutils literal notranslate"><span class="pre">&quot;subject&quot;</span></code> is omitted, then one model will be fit for each run,
combining all subjects for higher levels than the current node.</p>
</section>
<section id="enumerating-sequences-of-nodes">
<h3>Enumerating sequences of Nodes<a class="headerlink" href="#enumerating-sequences-of-nodes" title="Link to this heading">#</a></h3>
<p>To enumerate the sequences of <a class="reference internal" href="_autosummary/bsmschema.models.Node.html#bsmschema.models.Node" title="bsmschema.models.Node"><code class="xref py py-class docutils literal notranslate"><span class="pre">Node</span></code></a>s,
we use <code class="xref py py-class docutils literal notranslate"><span class="pre">Edges</span></code>.
Each <code class="docutils literal notranslate"><span class="pre">Edge</span></code> describes a single connection between two <code class="docutils literal notranslate"><span class="pre">Node</span></code>s,
and a combination of edges describes a sequence of <code class="docutils literal notranslate"><span class="pre">Node</span></code>s.</p>
<p>To demonstrate filtering, the following Edge links a subject-level model to a
dataset-level model that is exclusively fit to subjects with a value of “patient”
in a group column of a participants.tsv file:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;Edges&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span>
<span class="w">  </span><span class="nv">...</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="p p-Indicator">{</span>
<span class="w">    </span><span class="s">&quot;Source&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;subject-model&quot;</span>
<span class="w">    </span><span class="s">&quot;Destination&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;patient-model&quot;</span><span class="p p-Indicator">,</span>
<span class="w">    </span><span class="s">&quot;Filter&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">      </span><span class="s">&quot;group&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;patient&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="p p-Indicator">}</span>
<span class="w">  </span><span class="p p-Indicator">}</span>
<span class="p p-Indicator">]</span>
</pre></div>
</div>
<p>If <code class="docutils literal notranslate"><span class="pre">&quot;Edges&quot;</span></code> is not present in the model,
then a linear sequence is assumed from the first <code class="docutils literal notranslate"><span class="pre">Node</span></code> to the last,
with no filters specified on each <code class="docutils literal notranslate"><span class="pre">Edge</span></code>.</p>
</section>
</section>
<section id="inputs">
<h2>Inputs<a class="headerlink" href="#inputs" title="Link to this heading">#</a></h2>
<section id="specifying-image-inputs">
<h3>Specifying image inputs<a class="headerlink" href="#specifying-image-inputs" title="Link to this heading">#</a></h3>
<p>Specification of image inputs to a BIDS Model is deliberately minimalistic.
The spec itself says nothing about how images are to be passed in as inputs to the first node in a model spec;
this is deliberately left as an implementation detail for BIDS Model-compliant software.
To ensure independence of statistical modeling from preprocessing,
the spec also does not constrain what <em>kind</em> of images can be passed as inputs.
It does, however, allow any inputs passed in to be filtered on the basis of keywords
(or entities) defined in the core BIDS spec.
Minimally, this includes the <code class="docutils literal notranslate"><span class="pre">&quot;task&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;run&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;session&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;subject&quot;</span></code> keywords
(additional keywords may be added as they’re merged into the BIDS spec).
For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">{</span>
<span class="w">  </span><span class="s">&quot;Name&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;my_analysis&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;BIDSModelVersion&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;1.0.0&quot;</span><span class="p p-Indicator">,</span>
<span class="w">  </span><span class="s">&quot;Input&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">{</span>
<span class="w">    </span><span class="s">&quot;task&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;motor&quot;</span><span class="p p-Indicator">,</span>
<span class="w">    </span><span class="s">&quot;run&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="nv">1</span>
<span class="w">  </span><span class="p p-Indicator">},</span>
<span class="w">  </span><span class="s">&quot;Nodes&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">],</span>
<span class="w">  </span><span class="s">&quot;Edges&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">...</span><span class="p p-Indicator">],</span>
<span class="p p-Indicator">}</span>
</pre></div>
</div>
<p>In this example, we only want to analyze images for the motor task, and with a run index of 1.
The implication (which we make explicit here) is that all image inputs to a
BIDS Model-based analysis must be BIDS-compliant filenames.</p>
</section>
<section id="automatic-input-output-chaining-between-levels">
<h3>Automatic input/output chaining between levels<a class="headerlink" href="#automatic-input-output-chaining-between-levels" title="Link to this heading">#</a></h3>
<p>Beyond the initial (and optional) top-level <code class="docutils literal notranslate"><span class="pre">&quot;Input&quot;</span></code> field, inputs and outputs do not have to (and indeed, cannot) be explicitly specified anywhere in a BIDS-Model model.
Instead, all outputs from each node are automatically passed on as the inputs to the next node.
These inputs can be included or ignored as desired within the next node in the sequence; however, all outputs generated by a given node are implicitly assumed to be available in the namespace of the next node in the sequence unless an explicit filter is present in the connecting edge.</p>
<p>More concretely, each node receives as input from the previous node any contrasts defined within the <code class="docutils literal notranslate"><span class="pre">Contrasts</span></code> sections of the previous node.
Multiple lower-level inputs that share the same contrast name are automatically concatenated when they are read in.
For example, take the following partial model specification:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Nodes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;run&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;GroupBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;subject&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Model&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;glm&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;X&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;Word&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;Face&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nt">&quot;Contrasts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Word&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;ConditionList&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Word&quot;</span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;Weights&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Face&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;ConditionList&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Face&quot;</span><span class="p">],</span>
<span class="w">          </span><span class="nt">&quot;Weights&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Subject&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subject&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;GroupBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;contrast&quot;</span><span class="p">],</span>
<span class="w">      </span><span class="nt">&quot;Model&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Meta&quot;</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;X&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">]},</span>
<span class="w">      </span><span class="nt">&quot;DummyContrasts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">&quot;Test&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t&quot;</span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;Edges&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;Source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;run&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;Destination&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;subject&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this case, executing the first node, with the level “Run” (what is typically termed the 1st-level model) will produce contrast maps named “Face” and “Word” for each run and subject (because the <code class="docutils literal notranslate"><span class="pre">DummyContrasts</span></code> directive will automatically generate a 1 vs. 0 “t” contrast for each variable in <code class="docutils literal notranslate"><span class="pre">X</span></code>).
Suppose that there are three runs per subject.
Then, for each contrast (“Face” and “Word”),  a “Subject”-level model will have one input column with three rows.
The columns will always have the value 1 in all cells.
So, for the subject-level models, the input from the previous level will look like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">run_index</span>	<span class="n">Word</span>
<span class="mi">1</span>	<span class="mi">1</span>
<span class="mi">2</span>	<span class="mi">1</span>
<span class="mi">3</span>	<span class="mi">1</span>

<span class="n">run_index</span>	<span class="n">Face</span>
<span class="mi">1</span>	<span class="mi">1</span>
<span class="mi">2</span>	<span class="mi">1</span>
<span class="mi">3</span>	<span class="mi">1</span>
</pre></div>
</div>
<p>Note that we did not need to explicitly state anywhere that “Face” and “Word” should be passed as inputs to the 2nd level.
Those variables are automatically made available for use in the subject-level model, by virtue of the fact that (a) we set <code class="docutils literal notranslate"><span class="pre">DummyContrasts</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;t&quot;</span></code>, and (b) the subject-level Node is connected by an Edge from the run-level Node, so it has automatic access to all variables outputted by the run-level Node.</p>
<p>Note also that availability does not mandate inclusion: the fact that Face and Word contrasts were defined in the 1st Node does not mean that the user has to include them in a model specification in a 2nd Node.
If the Face contrast is not explicitly named as a predictor in the <code class="docutils literal notranslate"><span class="pre">Model</span></code> and/or <code class="docutils literal notranslate"><span class="pre">Contrasts</span></code> specifications in the 2nd Node, it will simply be ignored in all further analysis (meanig that it will not be passed onto further Nodes).
An important corollary of this principle is that <span style="text-decoration:underline;">variables must be explicitly named in the <code>Model</code> and/or <code>Contrasts</code> sections of every <code>Level </code>in order to be propagated to the next <code class="docutils literal notranslate"><span class="pre">Level</span></code>.
Note that Tests of “Type”: “F” are excluded from this, and not passed forward to other levels in the Model.</span></p>
</section>
<section id="automatic-ingestion-of-design-level-and-scan-level-variables">
<h3><strong>Automatic ingestion of design-level and scan-level variables</strong><a class="headerlink" href="#automatic-ingestion-of-design-level-and-scan-level-variables" title="Link to this heading">#</a></h3>
<p>Per the core BIDS spec, each level of analysis (meaning <code class="docutils literal notranslate"><span class="pre">run</span></code>, <code class="docutils literal notranslate"><span class="pre">session</span></code>, <code class="docutils literal notranslate"><span class="pre">subject</span></code>, or <code class="docutils literal notranslate"><span class="pre">dataset</span></code>) is associated with a different BIDS file or files that contains optional design events or variables.
These files are expected to be automatically read in and made available for inclusion in the model specification.
Specifically, the core BIDS spec defines the following level-to-file-to-variable mapping:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Level</p></th>
<th class="head"><p>BIDS file with variables</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Run</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">_events.tsv</span></code> file corresponding to the <code class="docutils literal notranslate"><span class="pre">image</span></code> file <br> <code class="docutils literal notranslate"><span class="pre">_stim.tsv.gz</span></code> file corresponding to the <code class="docutils literal notranslate"><span class="pre">image</span></code> file <br>  <code class="docutils literal notranslate"><span class="pre">_physio.tsv.gz</span></code> file corresponding to the <code class="docutils literal notranslate"><span class="pre">image</span></code> file <br> <code class="docutils literal notranslate"><span class="pre">_timeseries.tsv</span></code> file corresponding to the <code class="docutils literal notranslate"><span class="pre">image</span></code> file</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Session</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">_scans.tsv</span></code> file corresponding to the session</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Subject</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">_sessions.tsv</span></code> file corresponding to the subject</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Dataset</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">_participants.tsv</span></code> corresponding to the entire dataset</p></td>
</tr>
</tbody>
</table>
</div>
<p>Table 1. Analysis level, corresponding BIDS files and additional variables.</p>
<p>Within each <code class="docutils literal notranslate"><span class="pre">Node</span></code>, the expectation is that the namespace should automatically include all variables found within the corresponding file(s) defined in the table.
For example, if the <code class="docutils literal notranslate"><span class="pre">events.tsv</span> </code>files for a given project contain columns named “face” and “house”, then, inside any node with <code class="docutils literal notranslate"><span class="pre">Level=&quot;Run&quot;</span></code>, the user can automatically use the names <code class="docutils literal notranslate"><span class="pre">&quot;face&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;house&quot;</span></code> anywhere in the <code class="docutils literal notranslate"><span class="pre">Model</span></code> specification.</p>
<p>The expected formats for each of the file types listed in Table 1 are defined in the core BIDS spec, and any BIDS-Model-compliant software must respect the core spec and be able to read variables from all defined variable files.</p>
</section>
<section id="the-intercept-variable">
<h3>The intercept variable<a class="headerlink" href="#the-intercept-variable" title="Link to this heading">#</a></h3>
<p>The value <code class="docutils literal notranslate"><span class="pre">1</span></code> has a special status in <code class="docutils literal notranslate"><span class="pre">Model</span> </code>and <code class="docutils literal notranslate"><span class="pre">Contrast</span></code> definitions as an intercept variable that requires no explicit name.
A value of <code class="docutils literal notranslate"><span class="pre">1</span></code> in <code class="docutils literal notranslate"><span class="pre">Model.X</span></code> indicates an intercept column is to be added to the design matrix.
At higher-level Nodes, the intercept has an interpretable meaning (for example in the absence of other regressors, it is the sample mean) and may stand in for the name of the input contrast in <code class="docutils literal notranslate"><span class="pre">Model</span></code> and <code class="docutils literal notranslate"><span class="pre">Contrast</span></code> definitions.</p>
</section>
</section>
<section id="transformations">
<h2>Transformations<a class="headerlink" href="#transformations" title="Link to this heading">#</a></h2>
<p>The OPTIONAL <a class="reference internal" href="_autosummary/bsmschema.models.Node.html#bsmschema.models.Node.Transformations" title="bsmschema.models.Node.Transformations"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transformations</span></code></a> section of a Node allows one to specify transformations of variables that should be applied prior to constructing a design matrix.</p>
<p>It is not in the scope of this specification to design a universal transformation description that all implementing tools must provide.
Rather, this section describes a protocol that will permit a <code class="docutils literal notranslate"><span class="pre">Transformer</span></code> to provide its own specification language.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">Transformations</span></code> section has fields defined in <a class="reference internal" href="_autosummary/bsmschema.models.Transformations.html#bsmschema.models.Transformations" title="bsmschema.models.Transformations"><code class="xref py py-class docutils literal notranslate"><span class="pre">Transformations</span></code></a>.</p>
<p>An implementation of BIDS Stats Models MUST fail if it cannot interpret the specified instruction set and cannot call out to an external program that implements the instruction set.
At this time, no I/O protocol is set forth in this specification, and it is left to implementations of BIDS-Stats Models and a given <code class="docutils literal notranslate"><span class="pre">Transformer</span></code> specification to negotiate.
An I/O protocol may be specified in future versions of this document.</p>
<p>Here is an example of how a transformation is used in a run-level analysis.
For reference in this example, the events.tsv includes a column “trial_type_junk” with entries of congruent/incongruent/junk, where “junk” indicates junk trials (no response, etc) and “response_time”, which is the response time in seconds.
The first transformation, Factor, splits all events (rows of the events.tsv) into the three groupings, such that later on trial_type_junk.congruent will pull out the onset times of the congruent trials.
The “Scale” transformation is used to create an RT-modulated regressor where RT is mean centered.
Then the “Rename” transform is used to give nicer names to the output from the first transformation that used factor.
Last, regressors are convolved.
If you are accustomed to thinking about the time series regressors in a 3 column format (onset, duration, modulation) the transformations are basically setting up the modulation value and the onsets and durations are inherited from the corresponding columns in the events.tsv</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;run&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;run_flanker&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;GroupBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;run&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;session&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="s2">&quot;subject&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;Transformations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Transformer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pybids-transforms-v1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Instructions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Factor&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;Input&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;trial_type_junk&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Scale&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;Input&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;response_time&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;Demean&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;Rescale&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;Output&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;demeaned_response_time&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Rename&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;Input&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;trial_type_junk.congruent&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;trial_type_junk.incongruent&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;Output&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;congruent&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;incongruent&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Convolve&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;Model&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;spm&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;Input&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;congruent&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;incongruent&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;demeaned_response_time&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;Model&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;glm&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;X&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;congruent&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;incongruent&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;demeaned_response_time&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;framewise_displacement&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="mi">1</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here is an example of a transformation modeling a quadratic age effect in a dataset level node (group analysis).</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;QuadratricAgeEffect&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;GroupBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="s2">&quot;contrast&quot;</span>
<span class="w">  </span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;Transformations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Transformer&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;pybids-transforms-v1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Instructions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Product&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;Input&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;age&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="s2">&quot;age&quot;</span>
<span class="w">        </span><span class="p">],</span>
<span class="w">        </span><span class="nt">&quot;Output&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">          </span><span class="s2">&quot;age_squared&quot;</span>
<span class="w">        </span><span class="p">]</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;Model&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;X&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;age&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;age_squared&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="mi">1</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;glm&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;DummyContrasts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Test&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;t&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The following Transformers have specifications and reference implementations:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Transformer</p></th>
<th class="head"><p>Specification</p></th>
<th class="head"><p>Implementation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>pybids-transforms-v1</p></td>
<td><p><a class="reference external" href="https://docs.google.com/document/d/1uxN6vPWbC7ciAx2XWtT5Y-lBrdckZKpPdNUNpwRxHoU/edit#">PyBIDS Transformation Specification version 1</a></p></td>
<td><p><a class="github reference external" href="https://github.com/bids-standard/pybids">bids-standard/pybids</a></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="specifying-the-model">
<h2>Specifying the model<a class="headerlink" href="#specifying-the-model" title="Link to this heading">#</a></h2>
<p>The <a class="reference internal" href="_autosummary/bsmschema.models.Model.html#bsmschema.models.Model" title="bsmschema.models.Model"><code class="xref py py-class docutils literal notranslate"><span class="pre">Model</span></code></a> section of a <a class="reference internal" href="_autosummary/bsmschema.models.Node.html#bsmschema.models.Node" title="bsmschema.models.Node"><code class="xref py py-class docutils literal notranslate"><span class="pre">Node</span></code></a>
specifies the statistical model to be estimated.</p>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h3>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;Level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Run&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;Name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;run&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;GroupBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;run&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;session&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;subject&quot;</span><span class="p">],</span>
<span class="w">  </span><span class="nt">&quot;Model&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;glm&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;X&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;Face&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;Word&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;rot_x&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;rot_y&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="s2">&quot;rot_z&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="mi">1</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;Options&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;HighPassFilterCutoffHz&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.008</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;Software&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;SPM&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;whitening&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AR(1)&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;FSL&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;HRF_type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dgamma&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;whitening&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;FILM&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;AFNI&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;basis function&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CSPLIN&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;serial correlation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ARMA(1,1)&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="contrasts">
<h2>Contrasts<a class="headerlink" href="#contrasts" title="Link to this heading">#</a></h2>
<section id="contrast-specification">
<h3>Contrast specification<a class="headerlink" href="#contrast-specification" title="Link to this heading">#</a></h3>
<p>Contrasts are specified in the (optional) <code class="docutils literal notranslate"><span class="pre">Contrasts</span></code> section of each node, and define weighted sums of available parameter estimates.
All contrasts in each node must have unique names (though names can be reused across different nodes, and can be the same as design matrix columns).
The <code class="docutils literal notranslate"><span class="pre">Contrasts</span></code> section has the following form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;Level&quot;</span><span class="p">:</span> <span class="s2">&quot;Run&quot;</span><span class="p">,</span>
  <span class="o">...</span>
  <span class="s2">&quot;Contrasts&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;weighted sum&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ConditionList&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cond_001&quot;</span><span class="p">,</span> <span class="s2">&quot;cond_002&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;cond_003&quot;</span><span class="p">,</span> <span class="s2">&quot;cond_004&quot;</span><span class="p">],</span>
      <span class="s2">&quot;Weights&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;-1/3&quot;</span><span class="p">,</span> <span class="s2">&quot;-1/3&quot;</span><span class="p">,</span> <span class="s2">&quot;-1/3&quot;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;t-test 1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ConditionList&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cond_001&quot;</span><span class="p">,</span> <span class="s2">&quot;cond_002&quot;</span><span class="p">],</span>
      <span class="s2">&quot;Weights&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
      <span class="s2">&quot;Test&quot;</span><span class="p">:</span> <span class="s2">&quot;t&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;t-test 2&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ConditionList&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cond_003&quot;</span><span class="p">,</span> <span class="s2">&quot;cond_004&quot;</span><span class="p">],</span>
      <span class="s2">&quot;Weights&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
      <span class="s2">&quot;Test&quot;</span><span class="p">:</span> <span class="s2">&quot;t&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;My favorite F-test&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ConditionList&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cond_001&quot;</span><span class="p">,</span> <span class="s2">&quot;cond_002&quot;</span><span class="p">,</span>
                 <span class="s2">&quot;cond_003&quot;</span><span class="p">,</span> <span class="s2">&quot;cond_004&quot;</span><span class="p">],</span>
      <span class="s2">&quot;Weights&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
      <span class="s2">&quot;Test&quot;</span><span class="p">:</span> <span class="s2">&quot;F&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p><a class="reference internal" href="_autosummary/bsmschema.models.Node.html#bsmschema.models.Node.Contrasts" title="bsmschema.models.Node.Contrasts"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Contrasts</span></code></a> field contains a list of JSON objects,
where each object represents a single contrast,
defined in <a class="reference internal" href="_autosummary/bsmschema.models.Contrast.html#bsmschema.models.Contrast" title="bsmschema.models.Contrast"><code class="xref py py-class docutils literal notranslate"><span class="pre">Contrast</span></code></a>.</p>
</section>
<section id="dummy-contrasts">
<h3>Dummy contrasts<a class="headerlink" href="#dummy-contrasts" title="Link to this heading">#</a></h3>
<p>In addition to an explicit specification of individual contrasts,
the BIDS Stats Model spec also supports an optional <a class="reference internal" href="_autosummary/bsmschema.models.Node.html#bsmschema.models.Node.DummyContrasts" title="bsmschema.models.Node.DummyContrasts"><code class="xref py py-attr docutils literal notranslate"><span class="pre">DummyContrasts</span></code></a>
field that one can include as a field at the top level of each node.</p>
<p>Note that each contrast generated via <code class="docutils literal notranslate"><span class="pre">DummyContrasts</span></code> will have the same name as the variable it is based on.
However, in cases where the same name is re-used in the <code class="docutils literal notranslate"><span class="pre">Contrasts</span></code> list, the latter will take precedence over any contrast generated via <code class="docutils literal notranslate"><span class="pre">DummyContrasts</span></code>.
For example, if the design matrix contains a variable named <code class="docutils literal notranslate"><span class="pre">&quot;face&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">DummyContrasts</span></code> is <code class="docutils literal notranslate"><span class="pre">true</span></code>, and a contrast with the name<code class="docutils literal notranslate"> <span class="pre">&quot;face&quot;</span></code> is also included in <code class="docutils literal notranslate"><span class="pre">Contrasts</span></code>, only the latter will be retained, and the <code class="docutils literal notranslate"><span class="pre">DummyContrasts</span></code>-generated contrast will be ignored.</p>
<p>Note that tests of “Type: “F” will be computed but their parameters estimates will not be passed forward through an “Edge” to subsequent “Nodes” in the model.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="integration.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Integration with other standards</p>
      </div>
    </a>
    <a class="right-next"
       href="json_101.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">JSON 101</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-nodes">Analysis nodes</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-node-sequences">Specifying node sequences</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#node-structure">Node structure</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#enumerating-sequences-of-nodes">Enumerating sequences of Nodes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs">Inputs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-image-inputs">Specifying image inputs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-input-output-chaining-between-levels">Automatic input/output chaining between levels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automatic-ingestion-of-design-level-and-scan-level-variables"><strong>Automatic ingestion of design-level and scan-level variables</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-intercept-variable">The intercept variable</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#transformations">Transformations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#specifying-the-model">Specifying the model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#contrasts">Contrasts</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contrast-specification">Contrast specification</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dummy-contrasts">Dummy contrasts</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The BIDS Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>